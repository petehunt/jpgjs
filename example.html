<!DOCTYPE html>
<!-- Any copyright is dedicated to the Public Domain.
   - http://creativecommons.org/publicdomain/zero/1.0/ -->
<html>
<head>
<script src="jpgui.js"></script>
<script src="loris.js"></script>
<script>

  function getCanvas() {
    return document.getElementById('c1');
  }

  function getImageData(width, height) {
    var c = getCanvas();
    c.width = width;
    c.height = height;
    var ctx = c.getContext("2d");
    return ctx.getImageData(0,0,width,height);
  }

function main() {
  Loris.eval('importScripts("jpg.js", "jpgworker.js")', function() {});
  Loris.evalAsync('getJpgData("http://lorempixel.com/1024/1024/nature/1/", 1024, 1024, callback);', function(rv) {
    var imageData = getImageData(rv.width, rv.height);
    new CopyImageDataTask(rv.data, rv.numComponents, imageData, function() {
      var start = Date.now();
      getCanvas().getContext('2d').putImageData(imageData, 0, 0);
    });
  }, function(error) {
    console.error('errback', error);
  });
}
</script>
</head>
<body onload="main()">
  <canvas id="c1"></canvas><br />
</body></html>
